# 230325

- [[ìœ ë‹ˆí‹° ê°•ì¢Œ] ë‹¨ê°„ë¡ íŒŒë¥¼ ìœ ë‹ˆí‹°ë¡œ êµ¬í˜„í•˜ê¸° Part 16 ìºë¦­í„° ë“±ì¥ ì¡°ê±´](https://youtu.be/b0xHAtmYMhI?list=PLUZ5gNInsv_NG_UKZoua8goQbtseAo8Ow)



## 1. âŒ ~~ì—‘ì…€ íŒŒì¼ ì¶”ê°€~~ (ê¸°ì¡´ íŒŒì¼ê³¼ í†µí•©í•´ì•¼ í•¨)

> ì•„ë˜ì—ì„œ ë‚´ê°€ ì§„í–‰í•œ ë‚´ìš©ì€ ì“¸ë°ì—†ëŠ” ì¼ì´ì—ˆë‹¤.

- ìš°ì„  ì´ë²¤íŠ¸ ë³„ë¡œ êµ¬ë¶„í•˜ê¸° í¸í•˜ë„ë¡, ë³µë„ ì‹ ì—ì„œ ì“¸ ëŒ€ì‚¬ë“¤ì„ `dialogue_test_2.csv`ì— ìƒˆë¡œ ì‘ì„±í•´ ì£¼ì—ˆë‹¤.

- `Manage` ì˜¤ë¸Œì íŠ¸ì˜ `Database Manager`ê°€ csv íŒŒì¼ì˜ ì´ë¦„ì„ ë°›ì•„ì™€ì„œ, `Dialogue Parser`ê°€ íŒŒì‹±í•œ ë‹¤ìŒ DBì— ì €ì¥í•˜ëŠ”ë°, `Manage` ì˜¤ë¸Œì íŠ¸ëŠ” ì‹ ì´ ì „í™˜ë˜ì–´ë„ íŒŒê´´ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì—‘ì…€ íŒŒì¼ì„ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.

- ë”°ë¼ì„œ ì‹ ë§ˆë‹¤ ì–´ë–¤ ì—‘ì…€ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ê²ƒì¸ì§€ ì§€ì •í•˜ëŠ” ê²Œ ë‚«ê² ë‹¤ ì‹¶ì–´, `Database Manager`ì™€ `Dialogue Parser` ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶„ë¦¬í•´ ì£¼ê¸°ë¡œ í•˜ì˜€ë‹¤.

- `TestGameScene`ê³¼ `Corridor` ì‹ ì— `Dialogue DB` ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ê±°ê¸°ì— `Database Manager`ì™€ `Dialogue Parser` ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•´ ì£¼ì—ˆë‹¤.

  ![image-20230325224033803](Assets/230325.assets/image-20230325224033803.png)

  ![image-20230325224111206](Assets/230325.assets/image-20230325224111206.png)



- ì‹¤í–‰ ê²°ê³¼

  ![Honeycam_2023-03-25_22-43-17](Assets/230325.assets/Honeycam_2023-03-25_22-43-17.gif)

  - ~~ì‹  ì „í™˜ í›„ ìë™ ì´ë²¤íŠ¸ì—, ìƒˆë¡œ ì‘ì„±í•œ ëŒ€ì‚¬ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.~~
  - ê¸°ì¡´ `dialogue_test_1.csv` íŒŒì¼ì— ì´ì–´ì„œ ì ì—ˆë‹¤.



## 2. ìºë¦­í„°ì˜ ë“±ì¥ & í‡´ì¥ ì¡°ê±´

### (1) ì´ˆê¸° ì„¸íŒ…

- **ğŸ“‘ `DatabaseManager.cs` ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •**

- ë³€ìˆ˜

  ```c#
  public bool[] eventFlags = new bool[100];
  ```

  - ië²ˆ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ë©´, `eventFalgs[i]`ì˜ ê°’ì„ trueë¡œ ë³€ê²½í•œë‹¤. (`InteractionEvent`ì—ì„œ)
  - ë”°ë¼ì„œ, ì´ë¯¸ ë³¸ ì´ë²¤íŠ¸ì˜ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.



- **ğŸ“‘ `Dialogue.cs` ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •**

- `EventTiming` ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ ìƒì„±

  ```c#
  [System.Serializable]
  public class EventTiming
  {
      public int eventNum;            // í˜„ì¬ ì´ë²¤íŠ¸ì˜ ë²ˆí˜¸
      public int[] eventConditions;   // ì¡°ê±´ì´ ë˜ëŠ” ì´ë²¤íŠ¸ë“¤ì˜ ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸
      public bool conditionFlag;      // true: eventConditions ì´ë²¤íŠ¸ë¥¼ ë´¤ì„ ë•Œ ë“±ì¥ / false: ì•ˆ ë´¤ì„ ë•Œ ë“±ì¥
      public int eventEndNum;         // ì´ ë²ˆí˜¸ì˜ ì´ë²¤íŠ¸ë¥¼ ë³´ë©´ ë¬´ì¡°ê±´ í‡´ì¥
  }
  ```



- `DialogueEvent` ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ ìˆ˜ì •

  ```c#
  [System.Serializable]
  public class DialogueEvent
  {
      public string name;
      public EventTiming eventTiming;
  
      // ...
  }
  ```



### (2) ë“±ì¥ ë° í‡´ì¥ ì¡°ê±´ì´ ë˜ëŠ” ì´ë²¤íŠ¸ ì„¤ì •

- `Bear` ì˜¤ë¸Œì íŠ¸ì˜ `Interaction Event` ì»´í¬ë„ŒíŠ¸ ì¤‘ `Event Timing`ì˜ ë‚´ìš©ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.

  ![image-20230325230036328](Assets/230325.assets/image-20230325230036328.png)

  - `Event Num` = 1: í˜„ì¬ ëŒ€í™” ì´ë²¤íŠ¸ ë²ˆí˜¸ê°€ 1ë²ˆì´ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.
  - `Event Conditions`: 1ë²ˆ ì´ë²¤íŠ¸ê°€ ë“±ì¥í•˜ê¸° ìœ„í•œ ì¡°ê±´
    - `Size` = 1: ì´ ì´ë²¤íŠ¸ì˜ ë“±ì¥ ì¡°ê±´ì´ 1ê°œë¼ëŠ” ì˜ë¯¸ì´ë‹¤.
    - `Element[0]` = 0, `Condition Flag` = false: 0ë²ˆì§¸ ì´ë²¤íŠ¸ê°€ falseì¸ ê²½ìš°, ì¦‰ ì—†ëŠ” ê²½ìš° 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë“±ì¥ì‹œí‚¨ë‹¤. (ìš°ë¦¬ëŠ” 0ë²ˆì§¸ ì´ë²¤íŠ¸ê°€ ì—†ê¸° ë•Œë¬¸ì—, ë¬´ì¡°ê±´ ì´ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ëœë‹¤.)
  - `Event End Num` = 1: í•˜ì§€ë§Œ ë¬´ì¡°ê±´ ë“±ì¥ë§Œ ì‹œí‚¤ë©´ ì•ˆ ë˜ë¯€ë¡œ, 1ë²ˆ ì´ë²¤íŠ¸, ì¦‰ ìê¸° ìì‹ ì´ ëë‚˜ë©´ ìºë¦­í„°ê°€ ì‚¬ë¼ì§€ë„ë¡ í•œë‹¤.



- 1ë²ˆ ì´ë²¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ ìºë¦­í„°ê°€ ì‚¬ë¼ì ¸ì•¼ í•˜ê¸° ë•Œë¬¸ì—, `Go_disappear Targets`ì— `Bear` ì˜¤ë¸Œì íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.

  ![image-20230325230955051](Assets/230325.assets/image-20230325230955051.png)



- ì¦‰, 0ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ì§€ ì•Šì•˜ìœ¼ë©´ ìºë¦­í„°ê°€ ë“±ì¥í•´ì„œ, í•´ë‹¹ ìºë¦­í„°ë¥¼ í´ë¦­í•˜ë©´ 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŒì„ ëœ»í•œë‹¤.
- 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ê³  ë‚˜ë©´ ìºë¦­í„°ê°€ í‡´ì¥í•´ì„œ, 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ì—†ë‹¤.



### (3) ì‹¤ì§ˆì  ê¸°ëŠ¥ ì½”ë“œ ì‘ì„±

- **ğŸ“‘ `InteractionEvent.cs` ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •**

- `GetDialogue()` í•¨ìˆ˜ ìˆ˜ì •

  ```c#
  // DatabaseManagerì— ì €ì¥ëœ ì‹¤ì œ ëŒ€ì‚¬ ë°ì´í„°ë¥¼ êº¼ë‚´ì˜¨ë‹¤.
  public Dialogue[] GetDialogue()
  {
      DatabaseManager.instance.eventFlags[dialogueEvent.eventTiming.eventNum] = true; // í˜„ì¬ ì´ë²¤íŠ¸ì˜ ì‹¤í–‰ ì—¬ë¶€ë¥¼ trueë¡œ ì„¤ì •
  	
      // ...
  }
  ```

  - `dialogueEvent.eventTiming.eventNum`ì€ ìœ ë‹ˆí‹°ì—ì„œ ì„¤ì •í•œ, í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì´ë²¤íŠ¸ì˜ ë²ˆí˜¸ì´ë‹¤.
  - í˜„ì¬ ì´ë²¤íŠ¸ì˜ ë²ˆí˜¸ë¥¼ ì¸ë±ìŠ¤ë¡œ í•˜ì—¬, `eventFlags[eventNum]`ì˜ ê°’ì„ trueë¡œ ë³€ê²½í•œë‹¤.
  - `eventNum`ë²ˆ ì´ë²¤íŠ¸ë¥¼ ì´ë¯¸ ë³´ì•˜ìŒì„ ì˜ë¯¸í•œë‹¤.



- `CheckEvent()` í•¨ìˆ˜ ìƒì„±

  ```c#
  // ì´ ì´ë²¤íŠ¸(ìºë¦­í„°)ë¥¼ ë“±ì¥ì‹œí‚¬ì§€ ë§ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
  bool CheckEvent()
  {
      bool t_flag = true;	// trueë©´ ë“±ì¥, falseë©´ ë“±ì¥ X
  
      for (int i = 0; i < dialogueEvent.eventTiming.eventConditions.Length; i++)
      {
          // 1. ë“±ì¥ ì¡°ê±´ê³¼ ë³¸ ì´ë²¤íŠ¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´, ìºë¦­í„° ë“±ì¥ X
          // ì¡°ê±´ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ì˜ ì—¬ë¶€ (true, false)
          // í•´ë‹¹ ì´ë²¤íŠ¸ë¥¼ ë³´ì•„ì•¼ ë“±ì¥í•˜ëŠ”ì§€ì˜ ì—¬ë¶€ (true, false)
          if (DatabaseManager.instance.eventFlags[dialogueEvent.eventTiming.eventConditions[i]] != dialogueEvent.eventTiming.conditionFlag)
          {
              t_flag = false;
              break;
          }
  
          // 2. ìºë¦­í„° í‡´ì¥ ì¡°ê±´ì´ ë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë³´ì•˜ë‹¤ë©´, ìºë¦­í„° ë“±ì¥ X
          if (DatabaseManager.instance.eventFlags[dialogueEvent.eventTiming.eventEndNum])
          {
              t_flag = false; // ìºë¦­í„° ë“±ì¥ X
          }
      }
  
      return t_flag;
  }
  ```

  - `eventConditions` ë°°ì—´ì˜ ê¸¸ì´ë§Œí¼ ë°˜ë³µë¬¸ì„ ëˆë‹¤.
    - â‘  `eventConditions[i]` ê°’ì— í•´ë‹¹í•˜ëŠ” ë²ˆí˜¸ì˜ **ì´ë²¤íŠ¸ë¥¼ ë³´ì•˜ëŠ”ì§€ì˜ ì—¬ë¶€** (`eventFlags`)ì™€, **ê·¸ ì´ë²¤íŠ¸ë¥¼ ë³´ì•˜ì„ ë•Œ ìºë¦­í„°ë¥¼ ë“±ì¥ì‹œí‚¤ëŠ”ì§€ì˜ ì—¬ë¶€**(`conditionFlag`)ê°€ ê°™ì§€ ì•Šìœ¼ë©´, ìºë¦­í„°ë¥¼ ë“±ì¥ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤. (`t_flag` = false)
      - ì´ê²Œ ë¬´ìŠ¨ ë§ì´ëƒë©´,
      - ë§Œì•½ ë‚´ê°€ 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ì•˜ê³ , 3ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ì§€ ì•Šì•˜ë‹¤ë©´, `DatabaseManager`ì˜ `eventFlags[1]` = true, `eventFlags[3]` = falseì¼ ê²ƒì´ë‹¤.
      - í˜„ì¬ 5ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ê¸° ìœ„í•œ `eventConditions` = [1, 3]ì´ë¼ê³  í•˜ì.
        - âœ”ï¸ `conditionFlag` =  falseì¸ ê²½ìš°, 1ë²ˆ ì´ë²¤íŠ¸ì™€ 3ë²ˆ ì´ë²¤íŠ¸ë¥¼ ëª¨ë‘ ë³´ì§€ ì•Šì•„ì•¼ ìºë¦­í„°ê°€ ë“±ì¥í•˜ê²Œ ë  ê²ƒì´ë‹¤.
        - ì¦‰, `eventFlags[1]` = `eventFlags[3]` = `conditionFlag` = falseì¸ ê²½ìš° ìºë¦­í„°ê°€ ë“±ì¥í•œë‹¤.
        - í•˜ì§€ë§Œ, í˜„ì¬ `eventFlags[1]` = trueì´ê¸° ë•Œë¬¸ì—, `eventFlags[1]` != `conditionFlag`ê°€ ë˜ì–´ ìºë¦­í„°ê°€ ë“±ì¥í•˜ì§€ ì•Šê²Œ ëœë‹¤.
        - âœ”ï¸ `conditionFlag` =  trueì¸ ê²½ìš°, 1ë²ˆ ì´ë²¤íŠ¸ì™€ 3ë²ˆ ì´ë²¤íŠ¸ë¥¼ ëª¨ë‘ ë³´ì•„ì•¼ ìºë¦­í„°ê°€ ë“±ì¥í•˜ê²Œ ë  ê²ƒì´ë‹¤.
        - ì¦‰, `eventFlags[1]` = `eventFlags[3]` = `conditionFlag` = trueì¸ ê²½ìš° ìºë¦­í„°ê°€ ë“±ì¥í•œë‹¤.
        - í•˜ì§€ë§Œ, í˜„ì¬ `eventFlags[3]` = falseì´ê¸° ë•Œë¬¸ì—, `eventFlags[3]` != `conditionFlag`ê°€ ë˜ì–´ ìºë¦­í„°ê°€ ë“±ì¥í•˜ì§€ ì•Šê²Œ ëœë‹¤.
    - â‘¡ **`eventEndNum`ì— í•´ë‹¹í•˜ëŠ” ì´ë²¤íŠ¸**ë¥¼ ë³´ì•˜ë‹¤ë©´, ìºë¦­í„°ë¥¼ í‡´ì¥ì‹œí‚¨ë‹¤. (`t_flag` = false)



- `Start()` í•¨ìˆ˜ ìˆ˜ì •

  ```c#
  private void Start()
  {
      // ...
  
      bool t_flag = CheckEvent(); // ì´ ì´ë²¤íŠ¸(ìºë¦­í„°)ë¥¼ ë“±ì¥ì‹œí‚¬ì§€
      gameObject.SetActive(t_flag);
  }
  ```



### (4) ìºë¦­í„° ë“±ì¥ & í‡´ì¥

- ê¸°ì¡´ `TestGameScene`ì— ìˆëŠ” ë†ë‹´ê³°ê³¼ ëŒ€í™”í•˜ë©´ ê·¸ ë§µì˜ ë†ë‹´ê³°ì´ í‡´ì¥í•˜ê³ , `Corridor`ì— ë†ë‹´ê³°ì´ ë“±ì¥í•˜ë„ë¡ í•´ë³´ì.

-  `TestGameScene`ì— ìˆëŠ” ë†ë‹´ê³°ì€ ìœ„ì—ì„œ ì„¤ì •í•œëŒ€ë¡œ ë‘ê³ , `Corridor` ì‹ ì— ë†ë‹´ê³°ì„ í•˜ë‚˜ ì¶”ê°€í•œ í›„ `Interaction Event` ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.

  ![image-20230326001926494](Assets/230325.assets/image-20230326001926494.png)

  - ì´ ë†ë‹´ê³°ê³¼ ëŒ€í™”í•˜ëŠ” ì´ë²¤íŠ¸ì˜ ë²ˆí˜¸ëŠ” 2ë²ˆ (`Event Num` = 2)
  - ì¡°ê±´ì´ ë˜ëŠ” ì´ë²¤íŠ¸ëŠ” 1ë²ˆ (`Event Conditions` = [1])
  - 1ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ì•„ì•¼ ìºë¦­í„°ê°€ ë“±ì¥í•œë‹¤. (`Condition Flag` = true)
  - 3ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë³´ì•„ì•¼ ìºë¦­í„°ê°€ í‡´ì¥í•œë‹¤. (`Event End Num` = 3, ì•„ì§ 3ë²ˆ ì´ë²¤íŠ¸ëŠ” ì—†ìŒ.)
  - ì•„ ì´ê±° 1ì”© ëŠ˜ë ¤ì•¼ê² ë‹¤ (ìë™ ì´ë²¤íŠ¸ë¥¼ 2ë²ˆìœ¼ë¡œ í•˜ê³ ...)



- ì‹¤í–‰ ê²°ê³¼
  - ë†ë‹´ê³°ê³¼ ëŒ€í™”í•˜ì§€ ì•Šì€ í›„ ë§µì„ ì´ë™
  
    ![Honeycam_2023-03-28_19-46-08](Assets/230325.assets/Honeycam_2023-03-28_19-46-08.gif)
  
  
  
  - ë†ë‹´ê³°ê³¼ ëŒ€í™”í•œ í›„ ë§µì„ ì´ë™
  
    ![Honeycam_2023-03-28_19-46-58](Assets/230325.assets/Honeycam_2023-03-28_19-46-58.gif)



## 3. ë‹¤ìŒì— í•  ì¼

- ~~ì˜¤ë¸Œì íŠ¸ ë“±ì¥ ì¡°ê±´~~
- ì‚¬ìš´ë“œ ê´€ë ¨ ê¸°ëŠ¥ë“¤ êµ¬í˜„í•´ë³´ê¸° (íš¨ê³¼ìŒ, ë³´ì´ìŠ¤, ë°°ê²½ ìŒì•…)
- ì˜¤ë¸Œì íŠ¸ í´ë¡œì¦ˆì—…(í•˜ë©´ì„œ í™”ë©´ ì´ë™)í•˜ê¸°??
- ë§ˆìš°ìŠ¤ ì»¤ì„œì— ì• ë‹ˆë©”ì´ì…˜? ë„£ê¸°
- ë§ˆìš°ìŠ¤ ì»¤ì„œì— ì´í™íŠ¸ ë„£ê¸°
- ì˜¤ë¸Œì íŠ¸ íšë“ ë° í™œìš©
- í•œ ë²ˆë§Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ êµ¬í˜„
- ì¸ë²¤í† ë¦¬ ê¸°ëŠ¥
- **ì˜¤ë¸Œì íŠ¸ í´ë¦­ ì‹œ, ê°•ì¡°í•˜ëŠ” ì´í™íŠ¸ ë„£ê¸° & ì½”ë£¨í‹´ìœ¼ë¡œ ëŒ€ì‚¬ì°½ ë„ìš°ëŠ” ì‹œê°„ ì¡°ì •í•˜ê¸°**



## 4. í›„ê¸°

- ì½”ë“œê°€ ì‚´ì§ í—·ê°ˆë¦°ë‹¤. ì´ë²¤íŠ¸ì— ë²ˆí˜¸ ë¶™ì´ëŠ” ê±° ì•ˆ ê²¹ì¹˜ë„ë¡ ì¡°ì‹¬í•´ì•¼ í•  ê²ƒ ê°™ë‹¤.

- í•  ì¼ì´ ë– ì˜¬ëëŠ”ë° ê½¤ ì˜¤ë˜ ê±¸ë¦´ ê²ƒ ê°™ë‹¤...ã… ã… 
  - ë³µë„ ë§µì—ë„ ë¬¸ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ, `TestGameScene`ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸°
  - ì´ë²¤íŠ¸ ì¢…ë£Œ í›„ ë‹¤ì‹œ ì—°ì†ìœ¼ë¡œ ìë™ ì´ë²¤íŠ¸ ë‚˜ì˜¬ ë•Œ, ë†ë‹´ê³°ì´ ë°”ë¡œ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œë„ í•´ê²°í•˜ê¸°